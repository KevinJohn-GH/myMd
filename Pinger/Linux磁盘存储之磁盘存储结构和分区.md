##Linux磁盘存储之磁盘存储结构和分区
[TOC]

### ①主引导扇区的结构

主引导扇区大小是512字节

主引导扇区在磁盘上的位置：0盘面 0磁道 1扇区

**主引导扇区MBR组成：主引导记录区（main boot record）、硬盘分区表（disk partition  table）、分区结束标志位**

MBR包含硬盘一系列参数和一段引导程序，不依赖于操作系统（在执行MBR程序之后，操作系统才加载到内存）

修改MBR可实现双系统共存

![硬盘存储结构](https://img-blog.csdn.net/20180912122723374?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L01yX0JlaQ==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70)

### ②磁盘引导基本过程：

接电开机

-->执行BIOS程序，服务器完成一系列检查和配置

-->BIOS引导系统，把控制权交给硬盘

-->执行MBR上的程序，引导系统加载到内存

 


### ③为什么Linux操作系统只有四个分区
> MBR大小为512字节，由主引导记录区、硬盘分区表、分区结束标志位组成

其中主引导记录区占446字节，分区结束标志位占2字节，只剩下64字节给硬盘分区表
一个分区需要占用16字节，所以磁盘最多只能划分4个分区（3个主分区+1个扩展分区）

 


### ④为什么一个扩展分区可以划分成多个逻辑分区
> 因为扩展分区划分的多个逻辑分区，不存储在MBR中，而是存储在扩展分区中

> 拓展分区/dev/sdb4是无法挂载的，它下面划分的逻辑分区/dev/sdb5才能被挂载

   Device Boot      Start         End      Blocks   Id  System

/dev/sdb1               1         100      803218+  83  Linux

/dev/sdb2             101         200      803250   83  Linux

/dev/sdb3             201         600     3213000   83  Linux

/dev/sdb4             601         652      417690    5  Extended

/dev/sdb5             601         650      401593+  83  Linux


### ⑤如何对磁盘分区
磁盘分区就是对磁盘的主引导扇区中的磁盘分区表（64byte）进行设置

分区的工具：fdisk（适用于小于2T的磁盘）和 parted（适用于大于2T的磁盘）

磁盘划分（分区）的最小单位：柱面

查看分区信息：df -h       ：查看到的是挂载好的分区
                             fdisk-l    ：可以查看到未挂载的分区

磁盘设备名

IDE接口的硬盘：/dev/hda

SCSI、SATA接口的硬盘：/dev/sda  （主流）

 **磁盘分区重点**

1. 磁盘分区就是对磁盘的0磁道1扇区的主引导记录空间中的64byte进行设置；磁盘分区工具有fdisk（适用于小于2T的磁盘）和parted（倾向于大于2T的磁盘分区）
2. 一块磁盘的分区大小为64byte，最多可以划分为三个主分区和一个扩展分区
3. 磁盘分区最小的单位为柱面
4. 扩展分区不能直接使用，需要在扩展分区基础上创建逻辑分区
5. 因扩展分区有自己的分区表，故扩展分区中可以建立多个逻辑分区
6. 一般情况下在使用前要对磁盘进行分区，但不分区而直接进行格式化后使用也是没有问题的

**磁盘分区命名**

第一块IDE接口的硬盘名称为：/dev/hda

第二块IDE接口的硬盘名称为：/dev/hdb

第一块SCSI接口的硬盘名称为：/dev/sda

第一块SCSI接口的硬盘名称为：/dev/sdb




### ⑥添加硬盘步骤
1 设置里添加硬盘 设置好大小

2 重启虚拟机

3 看硬盘数据fdisk -l

4 设置新建的硬盘的分区  #fdisk /dev/sdb

5 将分区信息推送给内核  #partprobe /dev/sdb （目的：不需要重启服务器）

6 对创建的每个分区进行格式化 #mke2fs /dev/sdb1   或#mkfs.ext4 /dev/sdb1

7 新建需要被挂载的目录  #mkdir /date1

8 将每个分区挂载到目录（文件系统与目录树的关系）

mount /dev/sdb1 /data1

9 查看是否挂载完成``df -h`` （一旦挂载完成，之后无法修改）

 

 ``dumpe2fs /dev/sdb1``  #查看块组信息

 


### ⑦生产坏境分区建议
/boot ： 100M

/swap :   实际物理内存1.5倍

/            ：剩余磁盘大小

 


### ⑧Linux为什么要分区和格式化
分区的目的：
>记录每一个分区开始和结束的柱面，好管理

为什么要格式化：
因为各操作系统的文件属性和权限不同，为了让分区能够存放操作系统中的文件，
         需要将分区进行格式化，成为操作系统能够利用的系统格式

输入mke2fs /dev/sdb1

OS type：Linux #指定文件系统的类型

Block size=1024（log=0）#设定块的大小
